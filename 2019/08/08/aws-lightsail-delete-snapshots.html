<!DOCTYPE html>

<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>aws lightsail delete snapshots | uly.me</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="aws lightsail delete snapshots" />
<meta name="author" content="ulysses" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Here’s my script to delete AWS LightSail snapshots. It can delete daily or weekly backups and scheduled via crontab. If you want longer or shorter retention, adjust the expired value. It’s in seconds. 604800 is 1 week. 2592000 is 1 month." />
<meta property="og:description" content="Here’s my script to delete AWS LightSail snapshots. It can delete daily or weekly backups and scheduled via crontab. If you want longer or shorter retention, adjust the expired value. It’s in seconds. 604800 is 1 week. 2592000 is 1 month." />
<link rel="canonical" href="http://0.0.0.0:4000/2019/08/08/aws-lightsail-delete-snapshots.html" />
<meta property="og:url" content="http://0.0.0.0:4000/2019/08/08/aws-lightsail-delete-snapshots.html" />
<meta property="og:site_name" content="uly.me" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-08-08T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="aws lightsail delete snapshots" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ulysses"},"dateModified":"2019-08-08T00:00:00+00:00","datePublished":"2019-08-08T00:00:00+00:00","description":"Here’s my script to delete AWS LightSail snapshots. It can delete daily or weekly backups and scheduled via crontab. If you want longer or shorter retention, adjust the expired value. It’s in seconds. 604800 is 1 week. 2592000 is 1 month.","headline":"aws lightsail delete snapshots","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/2019/08/08/aws-lightsail-delete-snapshots.html"},"url":"http://0.0.0.0:4000/2019/08/08/aws-lightsail-delete-snapshots.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="uly.me" /></head>
<body><header class="site-header" role="banner">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">uly.me</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484l0,12.031c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,14.515,0,13.85,0,13.031V1.484 C0,0.665,0.665,0,1.484,0h15.032C17.335,0,18,0.665,18,1.484z"></path>
              <path d="M9,3c-1.657,0-3,1.343-3,3s1.343,3,3,3s3-1.343,3-3S10.657,3,9,3z"></path>
              <path d="M9,15.891c-4.274,0-8-1.343-8-3s3.726-3,8-3c0.537,0,1.074,0.041,1.605,0.117c0.376,1.371,1.453,2.408,2.77,2.408 c1.317,0,2.395-1.037,2.77-2.408C16.926,11.949,17.463,11.99,18,11.891c4.274,0,8,1.343,8,3s-3.726,3-8,3z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
<a class="page-link" href="/blog/">blog</a><a class="page-link" href="/docs.html">docs</a>
</div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">aws lightsail delete snapshots</h1>
    <p class="post-meta"><time class="dt-published" datetime="2019-08-08T00:00:00+00:00" itemprop="datePublished">
        Aug 8, 2019
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">ulysses</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Here’s my script to delete AWS LightSail snapshots. It can delete daily or weekly backups and scheduled via crontab. If you want longer or shorter retention, adjust the expired value. It’s in seconds. 604800 is 1 week. 2592000 is 1 month.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

current=$(date +%s)

if [ $# -eq 0 ]; then
  exit 1
fi

if [[ $1 = 'daily' ]]; then
  prefix='daily'
  expired=$(($current-604800))
elif [[ $1 = 'weekly' ]]; then
  prefix='weekly'
  expired=$(($current-2592000))
else
  exit 1
fi

snaps='/root/snapshots/snapshots.json'
names='/root/snapshots/names.txt'
parse='/root/snapshots/parse.txt'
logfile='/root/snapshots/snapshots.log'

/usr/local/bin/aws lightsail get-instance-snapshots &gt; $snaps
cat $snaps | jq -r '.instanceSnapshots[] | .name' &gt; $names
cat $names | grep $prefix &gt; $parse

while read -r line; do

  snapshot=$(echo $line | cut -d_ -f3)
  snapshotname=$line

  if [ `expr $snapshot + 1 2&gt; /dev/null` ] ; then

    if [ $snapshot -le $expired ]; then
      echo 'Deleted: '$snapshotname &gt;&gt; $logfile
      /usr/local/bin/aws lightsail delete-instance-snapshot \
      --instance-snapshot-name $snapshotname
    else
      echo 'Nothing: '$snapshotname &gt;&gt; $logfile
    fi

  else
    echo $snapshot is not numeric &gt; /dev/null
  fi

done &gt; $logfile
echo 'Expired time: '$expired &gt;&gt; $logfile
echo '-----------------------------------' &gt;&gt; $logfile
</code></pre></div></div>

<p>Schedule deletes via crontab.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># run daily at 5am
0 5 * * * /bin/bash /root/snapshots/delete-snapshot.sh daily 2&gt;&amp;1
# run weekly every sunday at 6am
0 6 * * 0 /bin/bash /root/snapshots/delete-snapshot.sh weekly 2&gt;&amp;1
</code></pre></div></div>

  </div>
<a class="u-url" href="/2019/08/08/aws-lightsail-delete-snapshots.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>
  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col-right">
        <p>copyright © 2012-2025</p>
      </div>
    </div>
    <div class="social-links">
<ul class="social-media-list"></ul>
</div>
  </div>
</footer>

</body>

</html>
