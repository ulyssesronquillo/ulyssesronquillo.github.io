<!DOCTYPE html>

<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>logging in to aws and gcp | uly.me</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="logging in to aws and gcp" />
<meta name="author" content="ulysses" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Here’s my Bash script to login to both AWS and GCP. It has a little bit of intelligence. It checks if you are already logged in, and skips if you are. If not logged in, it will open up the cloud web console which is protected by Okta. The script has been redacted and replace with generic usernames and web pages for security reasons." />
<meta property="og:description" content="Here’s my Bash script to login to both AWS and GCP. It has a little bit of intelligence. It checks if you are already logged in, and skips if you are. If not logged in, it will open up the cloud web console which is protected by Okta. The script has been redacted and replace with generic usernames and web pages for security reasons." />
<link rel="canonical" href="http://0.0.0.0:4000/2023/01/22/logging-in-to-aws-and-gcp.html" />
<meta property="og:url" content="http://0.0.0.0:4000/2023/01/22/logging-in-to-aws-and-gcp.html" />
<meta property="og:site_name" content="uly.me" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-01-22T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="logging in to aws and gcp" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"ulysses"},"dateModified":"2023-01-22T00:00:00+00:00","datePublished":"2023-01-22T00:00:00+00:00","description":"Here’s my Bash script to login to both AWS and GCP. It has a little bit of intelligence. It checks if you are already logged in, and skips if you are. If not logged in, it will open up the cloud web console which is protected by Okta. The script has been redacted and replace with generic usernames and web pages for security reasons.","headline":"logging in to aws and gcp","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/2023/01/22/logging-in-to-aws-and-gcp.html"},"url":"http://0.0.0.0:4000/2023/01/22/logging-in-to-aws-and-gcp.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="uly.me" /></head>
<body><header class="site-header" role="banner">
  <div class="wrapper">
    <a class="site-title" rel="author" href="/">uly.me</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484l0,12.031c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,14.515,0,13.85,0,13.031V1.484 C0,0.665,0.665,0,1.484,0h15.032C17.335,0,18,0.665,18,1.484z"></path>
              <path d="M9,3c-1.657,0-3,1.343-3,3s1.343,3,3,3s3-1.343,3-3S10.657,3,9,3z"></path>
              <path d="M9,15.891c-4.274,0-8-1.343-8-3s3.726-3,8-3c0.537,0,1.074,0.041,1.605,0.117c0.376,1.371,1.453,2.408,2.77,2.408 c1.317,0,2.395-1.037,2.77-2.408C16.926,11.949,17.463,11.99,18,11.891c4.274,0,8,1.343,8,3s-3.726,3-8,3z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/">blog</a></div>
      </nav>
</div>
</header>
<!--
<script src="/snowstorm.js"></script>
<script>
snowStorm.snowColor = '#99ccff';   // blue-ish snow!?
snowStorm.snowColor = '#ffffff';   // white snow
snowStorm.flakesMaxActive = 50;    // show more snow on screen at once
snowStorm.useTwinkleEffect = true; // let the snow flicker in and out of view
</script>
-->
<main class="page-content" aria-label="Content">
      <div class="wrapper">
          <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">logging in to aws and gcp</h1>
    <p class="post-meta"><time class="dt-published" datetime="2023-01-22T00:00:00+00:00" itemprop="datePublished">
        Jan 22, 2023
      </time>
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">ulysses</span></span></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Here’s my Bash script to login to both AWS and GCP. It has a little bit of intelligence. It checks if you are already logged in, and skips if you are. If not logged in, it will open up the cloud web console which is protected by Okta. The script has been redacted and replace with generic usernames and web pages for security reasons.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash
## CHECK IF LOGGED IN TO GCP 
read -p "Login to GCP? (y/n) : " login_gcp
if [[ $login_gcp = "y" ]]; then
  file1="/Users/username/code/etc/auth-gcp.txt"
  gcloud auth print-identity-token 1&gt; /dev/null 2&gt; $file
  user=$(gcloud config list account --format "value(core.account)")
  auth=$(cat "$file" | head -n 1)
  rm -f $file1
  if [[ $auth == "Reauthentication required." ]] ||  [[ $user != "first.last@domain.com" ]]; then
    echo "Logging in to Google Cloud Platform."
    gcloud auth login
    gcloud auth application-default login
    open https://okta-login
  else
    echo "You are already logged in to Google Cloud Platform."
  fi
else
  echo "Skipping GCP ... "
fi
## CHECK IF LOGGED IN TO AWS
read -p "Login to AWS? (y/n) : " login_aws
if [[ $login_aws = "y" ]]; then  
  file2=""/Users/username/code/etc/auth-aws.txt""
  aws sts get-caller-identity 2&gt; $file2
  expired=$(tail -n +2 "$file2")
  rm -f $file2
  if [[ $expired =~ "expired" ]] || [[ $expired =~ "Unable" ]]; then
    open https://okta-login
    echo "please wait until web page loads ... "
    read -p "Press any key to continue... " -n1 -s
    echo ""
    basecred='/Users/username/.aws/credentials.base'
    newcreds='/Users/username/Downloads/credentials'
    creds='/Users/username/.aws/credentials'
    if [ ! -f $newcreds ]; then
      echo 'No AWS credentials.'
      exit
    else
      cat $newcreds $basecred &gt; $creds
      echo 'New AWS credentials.'
      sleep 3
      rm -f $newcreds
    fi
  else
    echo "You are already logged in to AWS."
  fi
else 
  echo "Skipping AWS ... "
fi
</code></pre></div></div>

  </div>
<a class="u-url" href="/2023/01/22/logging-in-to-aws-and-gcp.html" hidden></a>


<div class="breadcrumbs">
  <a href="/">home</a> &gt; <a href="/blog/index.html">blog</a> &gt; <span class="breadcrumbs-url">/2023/01/22/logging-in-to-aws-and-gcp.html</span>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>
  <div class="wrapper">
    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col-right">
        <p>copyright © 2012-2026</p>
      </div>
    </div>
    <div class="social-links">
<ul class="social-media-list"></ul>
</div>
  </div>
</footer>

</body>

</html>
